{% extends "guide/base.html" %}

{% block content %}
<div class="screen">
  <!-- 사용자 정보 -->
  <div class="user-info">
    <span>로그인: {{ request.user.username }}</span>
    <form method="post" action="{% url 'logout' %}">
      {% csrf_token %}
      <button type="submit" class="logout">로그아웃</button>
    </form>
  </div>

  <div class="app-title">한화손보 유병자 인수 가이드</div>
  <div class="card container-narrow">
    <h2 style="margin-bottom:.5rem;">질병명 검색</h2>

    <!-- 검색창 -->
    <form method="post" action="{% url 'search' %}">
      {% csrf_token %}
      <div class="row">
        <input type="text" name="query" id="searchInput"
               placeholder="예시: 용종, 골절, 당뇨 등"
               value="{{ request.POST.query }}">
      </div>
      <button type="submit" id="searchBtn">검색</button>
      {% if results %}
      <button type="button" id="backBtn" class="secondary"
              onclick="window.location.href='{% url 'search' %}'"
              style="margin-top:8px;">뒤로가기</button>
      {% endif %}
    </form>

    <!-- 검색 결과 -->
    <div class="results" id="results">
      {% if results %}
        {% for d in results %}
        <div class="result-card">
          <div class="result-title">{{ d.name }}</div>
          <div class="result-sub">인수기준: {{ d.acceptance|default:"-" }}</div>
          <div class="result-sub">시그니처355: {{ d.signature355|default:"-" }}</div>

          <table class="info-table">
            <tr>
              <th>치료일수</th>
              <th>수술여부</th>
              <th>재발여부</th>
            </tr>
            <tr>
              <td>{{ d.treatmentDays|default:"-" }}</td>
              <td>{{ d.surgery|default:"-" }}</td>
              <td>{{ d.recurrence|default:"-" }}</td>
            </tr>
          </table>

          <div class="restrictions">
            제한사항: {{ d.restrictions|default:"없음" }}
          </div>
        </div>
        {% endfor %}
      {% elif request.method == "POST" %}
        <p class="hint">검색 결과가 없습니다.</p>
      {% endif %}
    </div>

    <div class="meta" style="margin-top:1rem;">
      Copyright 2025 하세봉 all rights reserved.
    </div>
  </div>
</div>
{% endblock %}
